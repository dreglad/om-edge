version: '3'

services:

  live2vod:
    image: pierrezemb/gostatic
    volumes:
      - ./om-dvr/build:/srv/http
    entrypoint: "/goStatic --fallback /index.html"

  admin-legacy:
    image: pierrezemb/gostatic
    volumes:
      - ./telesur-admin-legacy:/srv/http

  # kaltura:
  #   build: ./kaltura
  #   ports:
  #     - 80

  nginx:
    image: valian/docker-nginx-auto-ssl
    restart: on-failure
    environment:
      ALLOWED_DOMAINS: 'live2vod.openmultimedia.biz,admin.tlsur.net'
      SITES: 'live2vod.openmultimedia.biz=live2vod:80; admin.tlsur.net=admin-legacy:8043; _=admin-legacy:8043'
      FORCE_HTTPS: 'false'
    ports:
      - 80:80
      - 443:443
    volumes:
      - ssl_data:/etc/resty-auto-ssl
    depends_on:
      - admin-legacy
      - live2vod

volumes:
  ssl_data: