proxy_cache_path  /tmp/images_cache  levels=1:2    keys_zone=IMAGES:10m
    inactive=1y  max_size=3g;

upstream thumbor {
    server       thumbor:8000;
    keepalive    128;
}

server {
  listen 443 ssl;
  listen 80;
  server_name images.openmultimedia.biz imgs.openmultimedia.biz;

  include resty-server-https.conf;

  if ($request_method !~ "GET|HEAD") {
    return 405;
  }

  location ~ "^/(?<width>\d+)x(?<height>\d+)/(?<image>.+)$" {
    # proxy_pass http://thumbor/unsafe/${width}x0/media-telesur.openmultimedia.biz/$image;
    proxy_pass http://thumbor/unsafe/300x0/media-telesur.openmultimedia.biz/$image;
    proxy_cache IMAGES;
    proxy_cache_valid 200 1w;
  }

}
